<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Total Balance</title>
    
    <!-- Add Bootstrap CSS link -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        /* Custom CSS for fixing nav colors */
        #sidebar {
            background-color: #343a40; /* Change the background color to a darker shade */
            color: white; /* Set text color to white */
        }
    
        #sidebar .nav-link {
            color: white; /* Set the link text color to white */
        }
    
        #sidebar .nav-link.active {
            background-color: #007bff; /* Set the active link background color */
        }
    .delete-bill-btn {
        background-color: #e74c3c; /* Red background color */
        color: #fff; /* White text color */
        padding: 5px 10px; /* Padding around the text */
        border: none; /* No border */
        cursor: pointer; /* Show a pointer cursor on hover */
        border-radius: 5px; /* Rounded corners */
        transition: background-color 0.3s; /* Smooth color transition on hover */
}

/* Style the "Delete" button on hover */
    .delete-bill-btn:hover {
        background-color: #c0392b; /* Darker red on hover */
}
    </style>
    

</head>
<body>
    <div class="container">
        <div class="row">
            <!-- Sidebar -->
            <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-primary sidebar">
                <div class="position-sticky">
                    <ul class="nav flex-column">
                        <li class="nav-item" data-page="reports">
                            <a class="nav-link" href="#" data-toggle="collapse" data-target="#reports-menu">
                                <i class="fas fa-chart-line"></i> Reports
                            </a>
                            <div id="reports-menu" class="submenu">
                                <a class="nav-link" href="?page=total-balance">
                                    <i class="fas fa-balance-scale"></i> Balance Inquiry
                                </a>
                                <a class="nav-link" href="?page=general-ledger">
                                    <i class="fas fa-file-invoice-dollar"></i> General Ledger
                                </a>
                                <!-- Add a class "default-page" to the Bill Query link
                                <a class="nav-link default-page" href="?page=bill-query">
                                    <i class="fas fa-file-invoice"></i> Bill Query
                                </a> -->
                            </div>
                        </li>
                        <li class="nav-item" data-page="bills">
                            <a class="nav-link" href="#" data-toggle="collapse" data-target="#bills-menu">
                                <i class="fas fa-file-invoice"></i> Bills
                            </a>
                            <div id="bills-menu" class="submenu">
                                <a class="nav-link" href="?page=add-bills">
                                    <i class="fas fa-plus"></i> Add Bills
                                </a>
                                <a class="nav-link" href="?page=get-bills">
                                    <i class="fas fa-list"></i> Get Bills
                                </a>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
            
            



            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div id="page-content" style="display: none;">
                    <!-- Shared content for both pages -->
                    <h1>The Total Balance</h1>
                    
                </div>
                <div id="page-content-general-ledger" style="display: none;">
                    <!-- Shared content for both pages -->
                    <h1>General Ledger</h1>    
                </div>
                <div id="page-content-add-bills" style="display: none;">
                    <!-- Shared content for both pages -->
                    <h1>Create Bills</h1>    
                </div>
                <div id="page-content-get-bills" style="display: none;">
                    <!-- Shared content for both pages -->
                    <h1>Get Bills</h1> 
                </div>
                <div class="form-group" id="start_date_container" style="display: none;">
                    <label for="start_date">Start Date:</label>
                    <input type="date" class="form-control" id="start_date">
                </div>
                <div class="form-group" id="end_date_container" style="display: none;">
                    <label for="end_date">End Date:</label>
                    <input type="date" class="form-control" id="end_date">
                </div>
                <div class="form-group" id="bill_date_container" style="display: none;">
                    <label for="bill_date">Bill Date:</label>
                    <input type="date" class="form-control" id="bill_date">
                </div>
                <div class="form-group" id="bill_date_due_container" style="display: none;">
                    <label for="end_date">Bill Date Due:</label>
                    <input type="date" class="form-control" id="bill_date_due">
                </div>
                <div class="form-group" id="bill_name_container" style="display: none;">
                    <label for="bill_name">Name:</label>
                    <input type="text" class="form-control" id="bill_name">
                </div>
                
                <!-- <div class="form-group" id="bill_date_container" style="display: none;">
                    <label for="bill_date">Bill Date:</label>
                    <input type="date" class="form-control" id="bill_date">
                </div> -->
                <div class="form-group" id="partner_id_container" style="display: none;">
                    <label for="bill_parter_id">Partner ID:</label>
                    <input type="text" class="form-control" id="partner_id">
                </div>
                <div class="form-group" id="total_bill_amount_container" style="display: none;">
                    <label for="move_amount">Total Amount:</label>
                    <input type="text" class="form-control" id="move_amount">
                </div>
                <div class="form-group" id="move_type_container" style="display: none;">
                    <label for="move_type">Type:</label>
                    <input type="text" class="form-control" id="move_type" value="in_invoice">
                </div>
                <div class="form-group" id="reference_container" style="display: none;">
                    <label for="reference">Reference:</label>
                    <input type="text" class="form-control" id="reference">
                </div>
                <div class="form-group" id="narration_container" style="display: none;">
                    <label for="narration">Narration:</label>
                    <input type="text" class="form-control" id="narration">
                </div>
                
                
                
                

                <div class="form-group" id="account_select_container" style="display: none;">
                    <label for="selected_account_id">Select Account:</label>
                    <select class="form-control" id="selected_account_id" name="selected_account_id">
                        <option value="">-- Select Account --</option>
                        {% for account in account_data %}
                            <option value="{{ account.id }}">{{ account.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group" id="selected_partner_id_container" style="display: none;">
                    <label for="selected_partner_id">Select Partner:</label>
                    <select class="form-control" id="selected_partner_id" name="selected_partner_id">
                        <option value="">-- Select Partner --</option>
                        {% for partner in partner_data %}
                            <option value="{{ partner.id }}">{{ partner.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group" id="selected_analytic_container" style="display: none;">
                    <label for="selected_analytic_id">Select Analytic:</label>
                    <select class="form-control" id="selected_analytic_id" name="selected_analytic_id">
                        <option value="">-- Select Analytic Account --</option>
                        {% for account in account_data %}
                            <option value="{{ account.id }}">{{ account.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                        
                
                 <div class="button-group">
                                                
                    
                         <button id="getBalanceSumButton" style="display: none;" class="btn btn-primary">Get Balance Sum</button>

                         <button id="getLedgerButton" style="display: none;" class="btn btn-primary">Get Ledger Rebort</button>

                         <button id="CreateBillButton"  style="display: none;" class="btn btn-primary">Create Bill</button>
                         
                         <button id="GetBillButton"  style="display: none;" class="btn btn-primary">Get Bill</button>
                         <button id="DeleteBillButton"  style="display: none;" class="btn btn-danger ml-2">Delete Bills</button>
     
                         <!-- <button type="button" id="clearFormButton" class="btn btn-secondary ml-2">Clear</button> -->
                         <button type="button" id="clearFormButton" class="btn btn-secondary ml-2">Clear</button>

                         {% if user.is_authenticated %}
                         <form method="post" action="{% url 'logout' %}" class="d-inline">
                               {% csrf_token %}
                               <button type="submit" class="btn btn-warning ml-2">Logout</button>
                         </form>
                              {% endif %}

                        
                              <!-- Add a div element with Bootstrap styles to display the response data -->
                         <div id="response" class="mt-4"></div>
     
                             <!-- Add a div element to display the total_balance -->
                         <div id="total_balance" class="mt-4"></div>

                       
     
                             <!-- Add a div element for the "No data available" message -->
                         <!-- <div id="noDataMessage" class="alert alert-warning">No balances found.</div> -->
                    </form>     
                    </div>
            </main>
        </div>
    </div>

    <!-- Include jQuery and Bootstrap JavaScript from allowed sources -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    
    <script>
        
        $(document).ready(function() {
            // Parse the URL to determine the desired page
            const urlParams = new URLSearchParams(window.location.search);
            const pageParam = urlParams.get('page');
            
            // Load the specific page's content into the container
            if (pageParam === 'general-ledger') {
                $('#page-content-general-ledger').show();
                $('#account_select_container').show();
                $('#start_date_container').show();
                $('#end_date_container').show();
                $('#getLedgerButton').show();
            } 
            else if (pageParam === 'total-balance') {
                $('#page-content').show();
                $('#account_select_container').show();
                $('#end_date_container').show();
                $('#getBalanceSumButton').show();
            } 
            else if (pageParam === 'add-bills') {
                $('#bill_name_container').hide();
                $('#bill_date_container').show();
                $('#bill_date_due_container').show();
                $('#partner_id_container').hide();
                $('#move_type_container').hide();
                $('#total_bill_amount_container').show();
                $('#CreateBillButton').show();
                $('#selected_partner_id_container').show();
                $('#account_select_container').show();
                $('#selected_analytic_container').show();
                $('#reference_container').show();
                $('#narration_container').show();
                

                

                
                
                // $('#partner_partner_container').show();

                // partner_select_container
                
            }
            else if (pageParam === 'get-bills') {
                $('#start_date_container').show();
                $('#end_date_container').show();
                $('#selected_partner_id_container').hide();
                $('#account_select_container').hide();
                $('#selected_analytic_container').hide();
                $('#GetBillButton').show();
                $('#DeleteBillButton').show();

             
                
            } 
            else {
                $('#bill_date_container').show();
                $('#total_bill_amount_container').show();
                $('#CreateBillButton').show();
                $('#selected_partner_id_container').show();
                $('#account_select_container').show();
                $('#selected_analytic_container').show();

                        
            }    
            
                

                
  
           

                
            

    $.ajax({
    url: '/api/get-account-ids/',  // URL for the get_account_ids view
    type: 'GET',
    success: function (data) {
        // Clear existing options
        $('#selected_account_id').empty();

        // Add an empty default option
        $('#selected_account_id').append('<option value="">-- Select Account --</option>');

        // Add each account as an option in the select field
        $.each(data.account_data, function (index, account) {
            $('#selected_account_id').append('<option value="' + account.id + '">' + account.name + '</option>');
        });
    },
    error: function (error) {
        console.error('Error:', error);
    }
});
$.ajax({
    url: '/api/get-anylitic-ids/',  // URL for the get_account_ids view
    type: 'GET',
    success: function (data) {
        // Clear existing options
        $('#selected_analytic_id').empty();

        // Add an empty default option
        $('#selected_analytic_id').append('<option value="">-- Select Account --</option>');

        // Add each account as an option in the select field
        $.each(data.account_data, function (index, account) {
            $('#selected_analytic_id').append('<option value="' + account.id + '">' + account.name + '</option>');
        });
    },
    error: function (error) {
        console.error('Error:', error);
    }
});
$.ajax({
    url: '/api/get-partner-ids/',  // URL for the get_account_ids view
    type: 'GET',
    success: function (data) {
        // Clear existing options
        $('#selected_partner_id').empty();

        // Add an empty default option
        $('#selected_partner_id').append('<option value="">-- Select Partner --</option>');

        // Add each partner as an option in the select field
        $.each(data.partner_data, function (index, partner) {
            var option = $('<option>').attr('value', partner.id).text(partner.name);
            $('#selected_partner_id').append(option);
        });
    },
    error: function (error) {
        console.error('Error:', error);
    }
});
$('#getBalanceSumButton').click(function () {// Retrieve start_date, end_date, and selected_account_id values from the input fields
    var end_date = $('#end_date').val();
    var selected_account_id = $('#selected_account_id').val();

    

    // Check if "end_date" is required
    if (end_date === '') {
        // Display the "End Date is required" message in red
        $('#response').html('<span style="color: red;">End date is required.</span>');

        // Clear the total_balance value
        $('#total_balance').empty();
        return; // Exit the function, preventing further processing
    }

    
    if (selected_account_id === '') {
        // Display the "End Date is required" message in red
        $('#response').html('<span style="color: red;">Selected account is required.</span>');

        // Clear the total_balance value
        $('#total_balance').empty();
        return; // Exit the function, preventing further processing
    }



    // Make an AJAX request to initiate GetBalanceSumView with dynamic dates and selected_account_id

  
    $.ajax({
        url: '/api/get-balance-sum/',  // URL for the GetBalanceSumView
        type: 'GET',
        data: {
            // start_date: start_date,
            end_date: end_date,
            selected_account_id: selected_account_id  // Include selected_account_id in the request
        },
        success: function (data) {
            // Clear existing content
            $('#response').empty();
            

            if (data.response.length > 0) {
                var accountName = data.response[0].name;
                // Create a Bootstrap table to display the response data
                var tableHtml = '<table class="table">';
                tableHtml += '<thead><tr><th>Balance</th><th>Date</th></tr></thead><tbody>';
                    $.each(data.response, function (index, item) {
                          tableHtml += '<tr>';
                          tableHtml += '<td>' + item.balance + '</td>';
                          tableHtml += '<td>' + item.date + '</td>';
                          tableHtml += '</tr>';
        });
                tableHtml += '</tbody></table>';
                $('#response').html(tableHtml);

                // Display the total_balance value
                // $('#total_balance').text('Total Balance: ' + data.total_balance.toFixed(2));
            } else {
                // Handle the case when the response is empty
                $('#response').text('No data available.');

                // Clear the total_balance value
                // $('#total_balance').empty();
            }
       
        },
                error: function (error) {
                    // Handle any errors (if needed)
                    console.error('Error:', error);
                }
            });
        });
$('#getLedgerButton').click(function () {// Retrieve start_date, end_date, and selected_account_id values from the input fields
    var start_date = $('#start_date').val();
    var end_date = $('#end_date').val();
    var selected_account_id = $('#selected_account_id').val();

    
    if (start_date === '') {
        // Display the "End Date is required" message in red
        $('#response').html('<span style="color: red;">Start date is required.</span>');

        // Clear the total_balance value
        $('#total_balance').empty();
        return; // Exit the function, preventing further processing
    }

    // Check if "end_date" is required
    if (end_date === '') {
        // Display the "End Date is required" message in red
        $('#response').html('<span style="color: red;">End date is required.</span>');

        // Clear the total_balance value
        $('#total_balance').empty();
        return; // Exit the function, preventing further processing
    }

    
    if (selected_account_id === '') {
        // Display the "End Date is required" message in red
        $('#response').html('<span style="color: red;">Selected account is required.</span>');

        // Clear the total_balance value
        $('#total_balance').empty();
        return; // Exit the function, preventing further processing
    }



    // Make an AJAX request to initiate GetBalanceSumView with dynamic dates and selected_account_id

  
    $.ajax({
        url: '/api/get-ledger-sum/',  // URL for the GetBalanceSumView
        type: 'GET',
        data: {
            start_date: start_date,
            end_date: end_date,
            selected_account_id: selected_account_id  // Include selected_account_id in the request
        },
        success: function (data) {
            // Clear existing content
            $('#response').empty();

            if (data.response.length > 0) {
                // Create a Bootstrap table to display the response data
                var tableHtml = '<table class="table">';
                tableHtml += '<thead><tr><th>Root ID</th><th>Debit</th><th>Credit</th><th>Date</th><th>Analytic Account Name</th><th>Analytic Item Amount</th><th>Partner Name</th><th>Partner Type</th></tr></thead><tbody>';
                $.each(data.response, function (index, item) {
                    tableHtml += '<tr>';
                    tableHtml += '<td>' + item.account_root_id + '</td>';
                    tableHtml += '<td>' + item.debit + '</td>';
                    tableHtml += '<td>' + item.credit + '</td>';
                    tableHtml += '<td>' + item.date + '</td>';
                    tableHtml += '<td>' + item.analytic_account_name + '</td>';
                    tableHtml += '<td>' + item.analytic_account_amount + '</td>';
                    tableHtml += '<td>' + item.partner_id + '</td>';
                    tableHtml += '<td>' + item.partner_type + '</td>';

                    // tableHtml += '<td>' + item.anlytic_move_line_id + '</td>';
                    tableHtml += '</tr>';
                });
                tableHtml += '</tbody></table>';
                $('#response').html(tableHtml);

                // Display the total_balance value
                // $('#total_balance').text('Total Balance: ' + data.total_balance.toFixed(2));
            } else {
                // Handle the case when the response is empty
                $('#response').text('No data available.');

                // Clear the total_balance value
                $('#total_balance').empty();
            }
       
        },
        error: function (error) {
            // Handle any errors (if needed)
            console.error('Error:', error);
        }
    });

});


$('#clearFormButton').click(function () {
        // Reset the date fields and the dropdown
        $('#start_date, #end_date, #selected_account_id').val('');

        // Clear any response and total balance messages
        $('#response, #total_balance').empty();
    });
// $('#CreateBillButton').click(function() {
//     // Retrieve data from the form
//     var bill_date = $('#bill_date').val();
//     var partnerId = $('#partner_id').val();
//     var moveAmount = $('#move_amount').val();
//     var selected_partner_id = $('#selected_partner_id').val();
//     var moveType = 'in_invoice';
//     var selected_account_id = $('#selected_account_id').val();
//     var selected_analytic_id = $('#selected_analytic_id').val();

//     // Check if the required fields are filled
//     if (!bill_date || !selected_partner_id || !moveAmount) {
//         alert('Please fill in all required fields.');
//     } else {
//         // Create an object with the form data
//         var formData = {
//             bill_date: bill_date,
//             partner_id: selected_partner_id,
//             move_type: moveType,
//             move_amount: moveAmount,
//             selected_account_id: selected_account_id,
//             selected_analytic_id: selected_analytic_id
//         };

//         // Use an AJAX request to send the data to the Django view
//         $.ajax({
//             // Update the URL to match your Django view's URL
//             // url: '/create_bills/',
//             url: '/create_bills/?selected_partner_id=' + selected_partner_id + '&move_amount=' + moveAmount + '&selected_account_id=' + selected_account_id + '&bill_date=' + bill_date + '&selected_analytic_id=' + selected_analytic_id,
//             method: 'POST',
//             data: formData,
//             headers: {
//                 "X-CSRFToken": getCookie("csrftoken")
//             },
//             success: function(request) {
//                 // Display the response from the Django view
//                 $('#result').html(request.message);

//                 // Check if 'created_bills' is defined and is an array
//                 if (Array.isArray(request.created_bills)) {
//                     var createdBills = request.created_bills;

//                     // Reference to the table
//                     var table = $('#billTable');

//                     // Iterate through the new bills and add rows to the table
//                     createdBills.forEach(function(bill) {
//                         var row = '<tr>';
//                         row += '<td>' + bill[0] + '</td>'; // Bill ID
//                         row += '<td>' + bill[1] + '</td>'; // Bill Number
//                         row += '<td>' + bill[3] + '</td>'; // Bill Date
//                         row += '<td>' + bill[2] + '</td>'; // Bill Amount
//                         row += '<td>State</td>'; // You can set the 'State' value or retrieve it from your data
//                         row += '</tr>';
//                         table.append(row);
//                     });
//                 }
//             },
//             error: function(xhr, status, error) {
//                 console.log('Error:', error);
//             }
//         });
//     }
// });
$('#CreateBillButton').click(function() {
    // Retrieve data from the form
    var bill_date = $('#bill_date').val();
    var bill_date_due = $('#bill_date_due').val();
    var reference = $('#reference').val();
    var narration = $('#narration').val();
    var partnerId = $('#partner_id').val();
    var moveAmount = $('#move_amount').val();
    var selected_partner_id = $('#selected_partner_id').val();
    var moveType = 'in_invoice';
    var selected_account_id = $('#selected_account_id').val();
    var selected_analytic_id = $('#selected_analytic_id').val();

    // Check if the required fields are filled
    if (!bill_date || !selected_partner_id || !moveAmount) {
        alert('Please fill in all required fields.');
    } else {
        // Create an object with the form data
        var formData = {
            bill_date: bill_date,
            bill_date_due: bill_date_due,
            reference: reference,
            narration: narration,
            partner_id: selected_partner_id,
            move_type: moveType,
            move_amount: moveAmount,
            selected_account_id: selected_account_id,
            selected_analytic_id: selected_analytic_id
        };

        // Use an AJAX request to send the data to the Django view
        $.ajax({
            // Update the URL to match your Django view's URL
            // url: '/create_bills/',
            url: '/create_bills/?selected_partner_id=' + selected_partner_id + '&move_amount=' + moveAmount + '&selected_account_id=' + selected_account_id + '&bill_date=' + bill_date + '&bill_date_due=' + bill_date_due + '&reference=' + reference + '&narration=' + narration + '&selected_analytic_id=' + selected_analytic_id,
            method: 'POST',
            data: formData,
            headers: {
                "X-CSRFToken": getCookie("csrftoken")
            },
            // Assuming this code is inside your AJAX success callback
                success: function(response) {
                    // Clear existing content
                    $('#response').empty();

                    if (typeof response === 'string') {
                        // Display the success message in an alert
                        alert(response);
                    } else {
                        alert('No bill information found.');
                    }
                },
            error: function(xhr, status, error) {
                console.log('Error:', error);
            }
        });
    }
});

// Function to create a silent notification
function createSilentNotification(title, message) {
    if (Notification.permission === 'granted') {
        new Notification(title, { body: message, silent: true });
    } else if (Notification.permission !== 'denied') {
        Notification.requestPermission().then(function(permission) {
            if (permission === 'granted') {
                new Notification(title, { body: message, silent: true });
            }
        });
    }
}   


// $('#DeleteBillButton').click(function () {
//     // Retrieve start_date and end_date
//     var start_date = $('#start_date').val();
//     var end_date = $('#end_date').val();
//     // var bill_id = $('#bill_id').val();

//     // Check if the required fields are filled
//     if (!start_date || !end_date) {
//         alert('Please fill in both start date and end date.');
//     } else {
//         // Create an object with the start_date and end_date
//         var formData = {
//             start_date: start_date,
//             end_date: end_date
//         };
//     if (selected_partner_id === '') {
//         // Display the "End Date is required" message in red
//         $('#response').html('<span style="color: red;">Selected Partner is required.</span>');

//         // Clear the total_balance value
//         $('#total_balance').empty();
//         return; // Exit the function, preventing further processing
//     }

//         // Use an AJAX request to send the data to the Django view for deleting bills
//         $.ajax({
//             url: '/delete_bills/', // Replace with the actual URL of your Django view
//             method: 'POST',
//             data: formData,
//             headers: {
//                 "X-CSRFToken": getCookie("csrftoken") // Include the CSRF token in the headers
//             },
//             success: function (data) {
//                 // Display the response message
//                 $('#result').html(data.message);

              

//                 // Trigger a click event on the GetBillButton
//                 $('#GetBillButton').click();
//             },
//             error: function (xhr, status, error) {
//                 console.log('Error:', error);
//             }
//         });
//     }
// });
$('#DeleteBillButton').click(function () {
    // Retrieve start_date, end_date, and bill_id
    var start_date = $('#start_date').val();
    var end_date = $('#end_date').val();
    // var bill_id = $('#bill_id').val(); // Uncomment this line to retrieve bill_id

    // Check if the required fields are filled
    if (!start_date || !end_date) {
        alert('Please fill in both start date and end date.');
    } else {
        // Create an object with the start_date, end_date, and bill_id
        var formData = {
            start_date: start_date,
            end_date: end_date,
            // bill_id: bill_id // Include bill_id in the formData
        };

        // Perform additional validation if needed (e.g., check for selected_partner_id)

        // Use an AJAX request to send the data to the Django view for deleting bills
        $.ajax({
            url: '/delete_bills/', // Replace with the actual URL of your Django view
            method: 'POST',
            data: formData,
            headers: {
                "X-CSRFToken": getCookie("csrftoken") // Include the CSRF token in the headers
            },
            success: function (data) {
                // Display the response message
                $('#result').html(data.message);

                // Trigger a click event on the GetBillButton
                $('#GetBillButton').click();
            },
            error: function (xhr, status, error) {
                console.log('Error:', error);
            }
        });
    }
});

$('#GetBillButton').click(function() {
    // Retrieve data from the input fields
    var start_date = $('#start_date').val();
    var end_date = $('#end_date').val();
    
    // Check if the required fields are filled
    if (!start_date || !end_date) {
        alert('Please fill in both start date and end date.');
    } else {
        // Use an AJAX request to send the data to the Django view
        $.ajax({
            url: '/get_bills/',  // Replace with the actual URL of your Django view
            method: 'GET',  // Change method to GET
            data: { start_date: start_date, end_date: end_date},
            // Pass the date parameters as query parameters
            success: function(response) {
                // Clear existing content
                $('#response').empty();

                if ('bill_info' in response) {
                    var billInfo = response['bill_info'];

                    // Create a Bootstrap table to display the response data
                    var tableHtml = '<table class="table">';
                    tableHtml += '<thead><tr><th>Bill Number</th><th>Bill Date</th><th>Supplier ID</th><th>Account ID</th><th>Amount</th><th>State</th><th>Action</th></tr></thead><tbody>';

                    $.each(billInfo, function(index, item) {
                        tableHtml += '<tr>';
                        tableHtml += '<td>' + item.bill_number + '</td>';
                        tableHtml += '<td>' + item.bill_date + '</td>';
                        tableHtml += '<td>' + item.supplier_id + '</td>';
                        tableHtml += '<td>' + item.selected_account_id + '</td>';
                        tableHtml += '<td>' + item.amount + '</td>';
                        tableHtml += '<td>' + item.state + '</td>';
                        tableHtml += '<td><button class="delete-bill-btn" data-bill-id="' + item.bill_number + '">Delete</button></td>';
                        // Add more bill details here as needed
                        tableHtml += '</tr>';

                        // Log item.bill_number to the console
                        console.log('item.bill_number:', item.bill_number);
                    });

                    tableHtml += '</tbody></table>';
                    $('#response').html(tableHtml);

                    // Handle the "Delete" button clicks within the response table
                    $('#response').on('click', '.delete-bill-btn', function() {
                        var row = $(this).closest('tr');
                        // var billIdToDelete = $(this).data('bill-id'); // Corrected attribute name
                        var billIdToDelete = parseInt($(this).data('bill-id'));

                        // Use a confirmation dialog to confirm the deletion
                        var confirmDelete = confirm('Are you sure you want to delete this bill?');

                        if (confirmDelete) {
                            // Send an AJAX request to delete the bill with the ID billIdToDelete
                            $.ajax({
                                url: '/delete_bill/', // Replace with the actual URL of your Django view for deleting a single bill
                                method: 'POST',
                                data: { bill_id: billIdToDelete },
                                headers: {
                                    "X-CSRFToken": getCookie("csrftoken")
                                },
                                success: function(data) {
                                    // Handle the success response, e.g., remove the row from the table
                                    row.remove(); // Remove the row from the table
                                },
                                error: function(xhr, status, error) {
                                    console.log('Error:', error);
                                }
                            });
                        }
                    });
                } else {
                    alert('No bill information found.');
                }
            },
            error: function(xhr, status, error) {
                console.log('Error:', error);
            }
        });
    }
});

// $('#GetBillButton').click(function() {
//     // Retrieve data from the input fields
//     var start_date = $('#start_date').val();
//     var end_date = $('#end_date').val();
    
//     // Check if the required fields are filled
//     if (!start_date || !end_date) {
//         alert('Please fill in both start date and end date.');
//     } else {
//         // Use an AJAX request to send the data to the Django view
//         $.ajax({
//             url: '/get_bills/',  // Replace with the actual URL of your Django view
//             method: 'GET',  // Change method to GET
//             data: { start_date: start_date, end_date: end_date },
//             // Pass the date parameters as query parameters
//             success: function(response) {
//                 // Clear existing content
//                 $('#response').empty();

//                 if ('bill_info' in response) {
//                     var billInfo = response['bill_info'];

//                     // Create a Bootstrap table to display the response data
//                     var tableHtml = '<table class="table">';
//                     tableHtml += '<thead><tr><th>Bill Number</th><th>Bill Date</th><th>Supplier ID</th><th>Account ID</th><th>Amount</th><th>State</th><th>Action</th></tr></thead><tbody>';

//                     $.each(billInfo, function(index, item) {
//                         tableHtml += '<tr>';
//                         tableHtml += '<td>' + item.bill_number + '</td>';
//                         tableHtml += '<td>' + item.bill_date + '</td>';
//                         tableHtml += '<td>' + item.supplier_id + '</td>';
//                         tableHtml += '<td>' + item.selected_account_id + '</td>';
//                         tableHtml += '<td>' + item.amount + '</td>';
//                         tableHtml += '<td>' + item.state + '</td>';
//                         tableHtml += '<td><button class="delete-bill-btn" data-bill-id="' + item.bill_number + '">Delete</button></td>';
//                         // Add more bill details here as needed
//                         tableHtml += '</tr>';
//                     });

//                     tableHtml += '</tbody></table>';
//                     $('#response').html(tableHtml);

//                     // Handle the "Delete" button clicks within the response table
//                     $('#response').on('click', '.delete-bill-btn', function() {
//                         var row = $(this).closest('tr');
//                         // var billIdToDelete = 9
//                         var billIdToDelete = parseInt($(this).data('bill-id'));

//                         // Use a confirmation dialog to confirm the deletion
//                         var confirmDelete = confirm('Are you sure you want to delete this bill?');

//                         if (confirmDelete) {
//                             // Send an AJAX request to delete the bill with the ID billIdToDelete
//                             $.ajax({
//                                 url: '/delete_bill/', // Replace with the actual URL of your Django view for deleting a single bill
//                                 method: 'POST',
//                                 data: { bill_id: billIdToDelete },
//                                 headers: {
//                                     "X-CSRFToken": getCookie("csrftoken")
//                                 },
//                                 success: function(data) {
//                                     // Handle the success response, e.g., remove the row from the table
//                                     row.remove(); // Remove the row from the table
//                                 },
//                                 error: function(xhr, status, error) {
//                                     console.log('Error:', error);
//                                 }
//                             });
//                         }
//                     });
//                 } else {
//                     alert('No bill information found.');
//                 }
//             },
//             error: function(xhr, status, error) {
//                 console.log('Error:', error);
//             }
//         });
//     }
// });


// Function to get the CSRF token from cookies
function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = $.trim(cookies[i]);
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
 
     



});




            
    </script>
</body>
</html>
