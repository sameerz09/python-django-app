<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Total Balance</title>
    
    <!-- Add Bootstrap CSS link -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f5f5f5;
            font-family: 'Arial', sans-serif;
        }
        .container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            padding: 20px;
            margin-top: 20px;
            max-width: 600px;
            text-align: center;
        }
        h1 {
            color: #007bff;
        }
        .form-group {
            margin: 10px 0;
        }
        label {
            font-weight: bold;
        }
        select, input[type="date"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        .btn-primary {
            width: 100%;
            margin-top: 20px;
        }
        table {
            width: 100%;
            margin-top: 20px;
        }
        th {
            background-color: #007bff;
            color: #fff;
        }
        th, td {
            text-align: center;
            padding: 10px;
        }
        #total_balance {
            font-size: 1.5em;
            font-weight: bold;
            margin-top: 20px;
        }
        #noDataMessage {
            color: #d9534f;
            font-weight: bold;
            margin-top: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>The Total Balance</h1>
        
        <!-- Add date input fields -->
        <div class="form-group">
            <label for="start_date">Start Date:</label>
            <input type="date" class="form-control" id="start_date">
        </div>
        <div class="form-group">
            <label for="end_date">End Date:</label>
            <input type="date" class="form-control" id="end_date">
        </div>
        
        <!-- Add a dropdown list to select account IDs -->
        <div class="form-group">
            <label for="selected_account_id">Select Account ID:</label>
            <select class="form-control" id="selected_account_id">
                <option value="">-- Select Account ID --</option>
                {% for account_id in account_ids %}
                    <option value="{{ account_id }}">{{ account_id }}</option>
                {% endfor %}
            </select>
        </div>
        
        <button id="getBalanceSumButton" class="btn btn-primary">Get Balance Sum</button>

        <!-- Add a div element with Bootstrap styles to display the response data -->
        <div id="response" class="mt-4"></div>

        <!-- Add a div element to display the total_balance -->
        <div id="total_balance" class="mt-4"></div>

        <!-- Add a div element for the "No data available" message -->
        <div id="noDataMessage" class="alert alert-warning">No balances found.</div>
    </div>

    <!-- Include jQuery and Bootstrap JavaScript from allowed sources -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script> 
    
       $(document).ready(function () {
    // Fetch the account IDs from your Django view using AJAX
    $.ajax({
        url: '/api/get-account-ids/',  // URL for the get_account_ids view
        type: 'GET',
        success: function (data) {
            // Clear existing options
            $('#selected_account_id').empty();

            // Add an empty default option
            $('#selected_account_id').append('<option value="">-- Select Account ID --</option>');

            // Add each account ID as an option in the select field
            $.each(data.account_ids, function (index, account_id) {
                $('#selected_account_id').append('<option value="' + account_id.toString() + '">' + account_id.toString() + '</option>');
            });
        },
        error: function (error) {
            console.error('Error:', error);
        }
    });

    $('#getBalanceSumButton').click(function () {
    // Retrieve start_date, end_date, and selected_account_id values from the input fields
    var start_date = $('#start_date').val();
    var end_date = $('#end_date').val();
    var selected_account_id = $('#selected_account_id').val();

    // Check if "end_date" is required
    if (end_date === '') {
        // Display the "End Date is required" message in red
        $('#response').html('<span style="color: red;">End Date is required.</span>');

        // Clear the total_balance value
        $('#total_balance').empty();
        return; // Exit the function, preventing further processing
    }

    // Make an AJAX request to initiate GetBalanceSumView with dynamic dates and selected_account_id
    $.ajax({
        url: '/api/get-balance-sum/',  // URL for the GetBalanceSumView
        type: 'GET',
        data: {
            start_date: start_date,
            end_date: end_date,
            selected_account_id: selected_account_id  // Include selected_account_id in the request
        },
        success: function (data) {
            // Clear existing content
            $('#response').empty();

            if (data.response.length > 0) {
                // Create a Bootstrap table to display the response data
                var tableHtml = '<table class="table">';
                tableHtml += '<thead><tr><th>Account ID</th><th>Account Name</th><th>Balance</th><th>Root ID</th><th>Movement Date</th></tr></thead><tbody>';
                $.each(data.response, function (index, item) {
                    tableHtml += '<tr>';
                    tableHtml += '<td>' + item.account_id + '</td>';
                    tableHtml += '<td>' + item.account_name + '</td>';
                    tableHtml += '<td>' + item.balance + '</td>';
                    tableHtml += '<td>' + item.root_id + '</td>';
                    tableHtml += '<td>' + item.date + '</td>';
                    tableHtml += '</tr>';
                });
                tableHtml += '</tbody></table>';
                $('#response').html(tableHtml);

                // Display the total_balance value
                $('#total_balance').text('Total Balance: ' + data.total_balance);
            } else {
                // Handle the case when the response is empty
                $('#response').text('No data available.');

                // Clear the total_balance value
                $('#total_balance').empty();
            }
        },
        error: function (error) {
            // Handle any errors (if needed)
            console.error('Error:', error);
        }
    });
});
});

    </script>
</body>
</html>
